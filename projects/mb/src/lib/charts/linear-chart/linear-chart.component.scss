@use '@angular/material' as mat;
@use '@angular/material/core/tokens/token-utils';
@use './linear-chart';

/*
The following variables can be externally defined to style the chart.

--linear-chart-legend-color
--linear-chart-legend-font-family
--linear-chart-legend-font-size
--linear-chart-legend-font-weight
--linear-chart-axis-color
--linear-chart-axis-font-family
--linear-chart-axis-font-size
--linear-chart-axis-font-weight
--linear-chart-crosshair-wire-color
--linear-chart-crosshair-wire-width
--linear-chart-crosshair-wire-dasharray
--linear-chart-crosshair-annotation-background
--linear-chart-crosshair-annotation-color
--linear-chart-crosshair-annotation-font-family
--linear-chart-crosshair-annotation-font-size
--linear-chart-crosshair-annotation-font-weight
--linear-chart-nav-data-color
--linear-chart-nav-data-opacity
--linear-chart-nav-selection-color
--linear-chart-nav-selection-opacity
--linear-chart-ohlc-color
--linear-chart-ohlc-up-color
--linear-chart-ohlc-down-color
--linear-chart-candle-color
--linear-chart-candle-up-color
--linear-chart-candle-down-color
--linear-chart-line-color
--linear-chart-line-width
--linear-chart-area-color
--linear-chart-area-opacity
--linear-chart-point-color
--linear-chart-point-radius
--linear-chart-volume-color
--linear-chart-volume-opacity
--linear-chart-control-panel-background-color
--linear-chart-control-panel-header-color
--linear-chart-control-panel-variant-color
--linear-chart-control-panel-on-variant-color
--linear-chart-control-panel-variant-container-color
--linear-chart-control-panel-on-variant-container-color
*/

$fallbacks: linear-chart.get-tokens();

:host {
  ---linear-chart-legend-color: var(--linear-chart-legend-color, #{token-utils.slot(linear-chart-legend-color, $fallbacks)});
  ---linear-chart-legend-font-family: var(--linear-chart-legend-font-family, #{token-utils.slot(linear-chart-legend-font-family, $fallbacks)});
  ---linear-chart-legend-font-size: var(--linear-chart-legend-font-size, #{token-utils.slot(linear-chart-legend-font-size, $fallbacks)});
  ---linear-chart-legend-font-weight: var(--linear-chart-legend-font-weight, #{token-utils.slot(linear-chart-legend-font-weight, $fallbacks)});
  ---linear-chart-axis-color: var(--linear-chart-axis-color, #{token-utils.slot(linear-chart-axis-color, $fallbacks)});
  ---linear-chart-axis-font-family: var(--linear-chart-axis-font-family, #{token-utils.slot(linear-chart-axis-font-family, $fallbacks)});
  ---linear-chart-axis-font-size: var(--linear-chart-axis-font-size, #{token-utils.slot(linear-chart-axis-font-size, $fallbacks)});
  ---linear-chart-axis-font-weight: var(--linear-chart-axis-font-weight, #{token-utils.slot(linear-chart-axis-font-weight, $fallbacks)});
  ---linear-chart-crosshair-wire-color: var(--linear-chart-crosshair-wire-color, #{token-utils.slot(linear-chart-crosshair-wire-color, $fallbacks)});
  ---linear-chart-crosshair-wire-width: var(--linear-chart-crosshair-wire-width, #{token-utils.slot(linear-chart-crosshair-wire-width, $fallbacks)});
  ---linear-chart-crosshair-wire-dasharray: var(--linear-chart-crosshair-wire-dasharray, #{token-utils.slot(linear-chart-crosshair-wire-dasharray, $fallbacks)});
  ---linear-chart-crosshair-annotation-background: var(--linear-chart-crosshair-annotation-background, #{token-utils.slot(linear-chart-crosshair-annotation-background, $fallbacks)});
  ---linear-chart-crosshair-annotation-color: var(--linear-chart-crosshair-annotation-color, #{token-utils.slot(linear-chart-crosshair-annotation-color, $fallbacks)});
  ---linear-chart-crosshair-annotation-font-family: var(--linear-chart-crosshair-annotation-font-family, #{token-utils.slot(linear-chart-crosshair-annotation-font-family, $fallbacks)});
  ---linear-chart-crosshair-annotation-font-size: var(--linear-chart-crosshair-annotation-font-size, #{token-utils.slot(linear-chart-crosshair-annotation-font-size, $fallbacks)});
  ---linear-chart-crosshair-annotation-font-weight: var(--linear-chart-crosshair-annotation-font-weight, #{token-utils.slot(linear-chart-crosshair-annotation-font-weight, $fallbacks)});
  ---linear-chart-nav-data-color: var(--linear-chart-nav-data-color, #{token-utils.slot(linear-chart-nav-data-color, $fallbacks)});
  ---linear-chart-nav-data-opacity: var(--linear-chart-nav-data-opacity, #{token-utils.slot(linear-chart-nav-data-opacity, $fallbacks)});
  ---linear-chart-nav-selection-color: var(--linear-chart-nav-selection-color, #{token-utils.slot(linear-chart-nav-selection-color, $fallbacks)});
  ---linear-chart-nav-selection-opacity: var(--linear-chart-nav-selection-opacity, #{token-utils.slot(linear-chart-nav-selection-opacity, $fallbacks)});

  // To draw colored OHLCs use up-color: #6c0, down-color: #c60
  ---linear-chart-ohlc-color: var(--linear-chart-ohlc-color, #{token-utils.slot(linear-chart-ohlc-color, $fallbacks)});
  ---linear-chart-ohlc-up-color: var(--linear-chart-ohlc-up-color, #{token-utils.slot(linear-chart-ohlc-up-color, $fallbacks)});
  ---linear-chart-ohlc-down-color: var(--linear-chart-ohlc-down-color, #{token-utils.slot(linear-chart-ohlc-down-color, $fallbacks)});

  // To draw colored candles use up-color: #6c0, down-color: #c60
  ---linear-chart-candle-color: var(--linear-chart-candle-color, #{token-utils.slot(linear-chart-candle-color, $fallbacks)});
  ---linear-chart-candle-up-color: var(--linear-chart-candle-up-color, #{token-utils.slot(linear-chart-candle-up-color, $fallbacks)});
  ---linear-chart-candle-down-color: var(--linear-chart-candle-down-color, #{token-utils.slot(linear-chart-candle-down-color, $fallbacks)});

  // No fill colors for candlesticks in lightMode.
  ---linear-chart-candle-up-fill: transparent;
  ---linear-chart-candle-down-fill: var(---linear-chart-candle-down-color);

  ---linear-chart-line-color: var(--linear-chart-line-color, #{token-utils.slot(linear-chart-line-color, $fallbacks)});
  ---linear-chart-line-width: var(--linear-chart-line-width, #{token-utils.slot(linear-chart-line-width, $fallbacks)});

  ---linear-chart-area-color: var(--linear-chart-area-color, #{token-utils.slot(linear-chart-area-color, $fallbacks)});
  ---linear-chart-area-opacity: var(--linear-chart-area-opacity, #{token-utils.slot(linear-chart-area-opacity, $fallbacks)});

  ---linear-chart-point-color: var(--linear-chart-point-color, #{token-utils.slot(linear-chart-point-color, $fallbacks)});
  ---linear-chart-point-radius: var(--linear-chart-point-radius, #{token-utils.slot(linear-chart-point-radius, $fallbacks)});

  ---linear-chart-volume-color: var(--linear-chart-volume-color, #{token-utils.slot(linear-chart-volume-color, $fallbacks)});
  ---linear-chart-volume-opacity: var(--linear-chart-volume-opacity, #{token-utils.slot(linear-chart-volume-opacity, $fallbacks)});

  ---linear-chart-control-panel-background-color: var(--linear-chart-control-panel-background-color, #{token-utils.slot(linear-chart-control-panel-background-color, $fallbacks)});
  ---linear-chart-control-panel-header-color: var(--linear-chart-control-panel-header-color, #{token-utils.slot(linear-chart-control-panel-header-color, $fallbacks)});
  ---linear-chart-control-panel-variant-color: var(--linear-chart-control-panel-variant-color, #{token-utils.slot(linear-chart-control-panel-variant-color, $fallbacks)});
  ---linear-chart-control-panel-on-variant-color: var(--linear-chart-control-panel-on-variant-color, #{token-utils.slot(linear-chart-control-panel-on-variant-color, $fallbacks)});
  ---linear-chart-control-panel-variant-container-color: var(--linear-chart-control-panel-variant-container-color, #{token-utils.slot(linear-chart-control-panel-variant-container-color, $fallbacks)});
  ---linear-chart-control-panel-on-variant-container-color: var(--linear-chart-control-panel-on-variant-container-color, #{token-utils.slot(linear-chart-control-panel-on-variant-container-color, $fallbacks)});
}

// Checks if any ancestor element (including document.documentElement) has the darkMode class.
// This is used to apply dark mode styles conditionally.
// The styles will automatically update when the darkMode class is added/removed from the document.
:host-context(.darkMode) {
  ---linear-chart-candle-up-fill: var(---linear-chart-candle-up-color);
  ---linear-chart-candle-down-fill: transparent;
}

:host {
  // Axis and tick labels
  ::ng-deep g.axis{
    path {
      stroke: var(---linear-chart-axis-color);
    }
    line {
      stroke: var(---linear-chart-axis-color);
    }
    text {
      fill: var(---linear-chart-axis-color);
      font-family: var(---linear-chart-axis-font-family);
      font-size: var(---linear-chart-axis-font-size);
      font-weight: var(---linear-chart-axis-font-weight);
    }
  }
  // Crosshair
  ::ng-deep g.crosshair {
    path.wire {
      stroke: var(---linear-chart-crosshair-wire-color);
      stroke-dasharray: var(---linear-chart-crosshair-wire-dasharray);
      stroke-width: var(---linear-chart-crosshair-wire-width);
    }
    g.axisannotation {
      path {
        cursor: crosshair;
        fill: var(---linear-chart-crosshair-annotation-background);
      }    
      text {
        font-family: var(---linear-chart-crosshair-annotation-font-family);
        font-size: var(---linear-chart-crosshair-annotation-font-size);
        font-weight: var(---linear-chart-crosshair-annotation-font-weight);
        fill: var(---linear-chart-crosshair-annotation-color);
      }
    }
  }
  // Navigation and selection
  ::ng-deep g.nav {
    g.area g.data path.area {
      fill: var(---linear-chart-nav-data-color);
      fill-opacity: var(---linear-chart-nav-data-opacity);
    }
    g.pane rect.selection {
      fill: var(---linear-chart-nav-selection-color);
      fill-opacity: var(---linear-chart-nav-selection-opacity);
      stroke: none;
    }
  }
  // Indicator legend
  ::ng-deep g.legend text {
    fill: var(---linear-chart-legend-color);
    font-family: var(---linear-chart-legend-font-family);
    font-size: var(---linear-chart-legend-font-size);
    font-weight: var(---linear-chart-legend-font-weight);
  }
  // Candlesticks
  ::ng-deep path.candle {
    stroke: var(---linear-chart-candle-color);
    stroke-width: 1px; 
    &.up {
      stroke: var(---linear-chart-candle-up-color);
      fill: var(---linear-chart-candle-up-fill);
    }
    &.down {
      stroke: var(---linear-chart-candle-down-color);
      fill: var(---linear-chart-candle-down-fill);
    }
  }
  // OHLCs
  ::ng-deep path.ohlc {
    stroke: var(---linear-chart-ohlc-color);
    stroke-width: 1px;
    fill: none;
    &.up {
      stroke: var(---linear-chart-ohlc-up-color);
    }
    &.down {
      stroke: var(---linear-chart-ohlc-down-color);
    }
  }
  // Lines
  ::ng-deep path.line {
    fill: none;
    stroke: var(---linear-chart-line-color);
    stroke-width: var(---linear-chart-line-width);
  }
  // Area
  ::ng-deep path.area {
    fill: var(---linear-chart-area-color);
    fill-opacity: var(---linear-chart-area-opacity);
    stroke: none;
  }
  // Points
  ::ng-deep path.point {
    fill: none;
    stroke: var(---linear-chart-point-color);
    stroke-width: var(---linear-chart-point-radius);
  }
  // Volume bars
  ::ng-deep path.volume {
    fill: var(---linear-chart-volume-color);
    fill-opacity: var(---linear-chart-volume-opacity);
    stroke: none;
  }

  // Control panel
  .container {
    margin: 0;
    padding: 0 8px;
    height: 1px;
  }

  @include mat.expansion-overrides((
    container-background-color: var(---linear-chart-control-panel-background-color),
    header-text-color: var(---linear-chart-control-panel-header-color),
  ));

  .button-toggle-group {
    margin: 0px;
    margin-right: 16px;
  }

  @include mat.button-toggle-overrides((
    background-color: var(---linear-chart-control-panel-variant-color),
    text-color: var(---linear-chart-control-panel-on-variant-color),
    selected-state-background-color: var(---linear-chart-control-panel-variant-container-color),
    selected-state-text-color: var(---linear-chart-control-panel-on-variant-container-color),
  ));

  .mat-button-toggle-appearance-standard .svg-icon {
    stroke: var(---linear-chart-control-panel-on-variant-color);
  }
  .mat-button-toggle-checked .svg-icon {
    stroke:  var(---linear-chart-control-panel-on-variant-container-color);
  }

  .slide-toggle {
    margin: 0;
    margin-right: 16px;
    vertical-align: middle;
  }

  @include mat.slide-toggle-overrides((
    selected-focus-handle-color: var(---linear-chart-control-panel-variant-container-color),
    selected-focus-state-layer-color: var(---linear-chart-control-panel-variant-color),
    selected-focus-track-color: var(---linear-chart-control-panel-variant-color),
    selected-handle-color: var(---linear-chart-control-panel-variant-on-color),
    selected-hover-handle-color: var(---linear-chart-control-panel-variant-container-color),
    selected-hover-state-layer-color: var(---linear-chart-control-panel-variant-color),
    selected-hover-track-color: var(---linear-chart-control-panel-variant-color),
    selected-icon-color: var(---linear-chart-control-panel-on-variant-container-color),
    selected-pressed-handle-color: var(---linear-chart-control-panel-variant-container-color),
    selected-pressed-state-layer-color: var(---linear-chart-control-panel-variant-color),
    selected-pressed-track-color: var(---linear-chart-control-panel-variant-color),
    selected-track-color: var(---linear-chart-control-panel-variant-color),
  ));

  mat-slide-toggle mat-icon {
    vertical-align: bottom;
  }

  .download {
    vertical-align: middle;
    @include mat.fab-overrides((
      small-container-color: var(---linear-chart-control-panel-variant-container-color),
      small-foreground-color: var(---linear-chart-control-panel-on-variant-container-color),
      small-state-layer-color: var(---linear-chart-control-panel-on-variant-container-color),
      small-ripple-color: linear-chart.get-ripple-color(
        var(---linear-chart-control-panel-on-variant-container-color)),
    ))
  }
}
